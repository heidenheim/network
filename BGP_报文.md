# BGP报文类型
BGP存在5种类型的报文，同样OSPF和EIGRP也都是五种报文。
BGP报文类型有 
1. Open
2. Update
3.  Notification
4. Keepalive
5.  Route-refresh

不同于常见的IGB协议，BGP使用TCP作为传输层协议，端口号179，这使得BGP支持非直连（跨设备）的路由器之间建立对等体关系。

在OPEN报文里含有：
1. Router ID
2. AS号
3. 超时间隔（默认180s）
4. 路由器能力（支持IPv4/6...）

在BGP中OPEN报文的作用是用于建立BGP对等体之间的连接，并协商一些初始参数，具体来说OPEN报文的作用包含以下几点
1. 建立会话 当BGP对等体第一次建立连接时，他们会互相发送OPEN报文，开始会话的建立	过程。
2. 交换能力 OPEN报文中包含了一些关键的参数，比如BGP版本号、本地主机的AS号、保	持时间（Keepalive timer）、BGP标识符（Router ID）等。这些信息用于双方协商会话的	特性，以确保能正常通信。
3. 协商功能 OPEN报文还可以携带可选参数（Optional Parameters），用于协商BGP扩展	功能（如多协议支持，路由反射，BGP社区等）。这些扩展功能的支持情况在OPEN报文的	交换过程中确认。
4. 会话确认 如果确认两个BGP对等体的OPEN报文协商成功，他们将进入后续的BGP状态机	步骤（如发送Keepalive报文）。如果协商失败（例如版本不匹配或参数冲突）会话将终止。

总结来说Open报文在BGP中将起到初始化会话，交换和协商参数的关键作用，是BGP对等体建立连接的第一步。

Update报文的作用在于BGP对等体之间传递路由信息
1. 通过新路由 update报文用于通告新路由到BGP对等体。这个报文会包含一组网络前缀和与之关联的路劲属性，这些信息可以让对等体知道如何到达这些网络。
2. 撤销路由：UPDATE报文还可以用于撤销（撤回）以前通告的路由。如果某个路由已经失效或者不再可达，BGP对等体会通过UPDATE报文通知其对等体，告知该路由不再可用。
3. 更新路由信息：当某个已知路由的路径属性发生变化（例如下一跳、AS路径、MED值等），BGP会通过UPDATE报文向对等体通告这些更新后的信息。
4. 路径属性传递：UPDATE报文还包括一系列路径属性，如AS路径、下一跳（NextHop）、	本地优先级(Local Preference)、多出口鉴别(MED)、BGP社区等。这些路径属性帮助BGP	对等体评 估和选择最佳路径。

总而言之，UPDATE报文在BGP中负责传递、更新和撤销路由信息，是BGP协议中路由信息交换的核心

在BGP（边界网关协议）中，NOTIFICATION报文的作用是用于通告BGP对等体检测到的错误或异常，并终止BGP会话。具体来说，NOTIFICATION报文的功能包括以下几个方面：

1. 错误报告：当BGP对等体在协议的运行过程中检测到错误（例如协议消息格式错误、接收	到无效的参数、非法的路径属性等），它会立即发送NOTIFICATION报文，通知对等体出现	了问题。

2. 终止会话：发送NOTIFICATION报文后，BGP会话会立即关闭。NOTIFICATION报文的发	送标志着 BGP对等体之间的通信即将结束，以防止传播有问题的路由信息。

3. 错误代码和子代码：NOTIFICATION报文包含一个错误代码和可选的子代码，用于精确描	述检测到的问题类型。例如，错误代码可以表示“消息头错误”、“OPEN消息错			误”或“UPDATE消息错误”等，而子代码则进一步细化错误的具体原因。

4. 提供故障诊断信息：NOTIFICATION报文中还可以包含一些与错误相关的附加数据，这些	数据有助于对等体或网络管理员进行故障诊断和排查。

总而言之，NOTIFICATION报文在BGP中起到了错误报告和会话终止的作用。它确保当BGP对等体之间发生严重错误时，会话能够及时关闭，从而维持网络的稳定性和安全性。收到后会立即断链但是也会一直尝试重建直到修复为止

在BGP（边界网关协议）中，KEEPALIVE报文的作用是用于维护BGP对等体之间的会话连接。具体功能包括以下几点：
1. 保持连接状态：KEEPALIVE报文用于确认BGP对等体之间的连接仍然有效。通过定期发送	KEEPALIVE报文，BGP对等体能够互相告知对方其会话连接是正常的，没有发生中断。
2. 防止超时：在BGP会话建立后，如果一段时间内没有任何消息（例如UPDATE或KEEPALIVE报文）从对等体接收，会话可能会被认为已断开。通过定期发送KEEPALIVE报	文，可以防止会话由于长时间没有通信而超时断开。
3. 支持会话建立后不发送路由信息：在BGP会话建立后，即使没有需要通告的路由信息，	BGP对等体仍然会定期交换KEEPALIVE报文，以确保对等体之间的连接保持活动状态。
4. 简洁高效：KEEPALIVE报文非常简短，不携带任何路由信息，其唯一目的是维持BGP会话	的活跃状态。因此，它消耗的网络资源极少，同时也能有效监控连接的状态。

总结来说，KEEPALIVE报文在BGP中用于定期验证对等体之间的会话是否存活，确保BGP会话的稳定性和连续性，是BGP对等体保持长时间连接的关键机制之一。Keepalive 虽然超时时间是180s但是每60s会发送一个keepalive报文。BGP不会轻易断链，因为实际上GBP收敛可能需要好几个星期。以及对OPEN报文的确认